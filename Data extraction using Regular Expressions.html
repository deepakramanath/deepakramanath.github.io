
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://deepakramanath.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://deepakramanath.github.io/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://deepakramanath.github.io/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://deepakramanath.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Deepak Ramanath Atom">




    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="Deepak Ramanath" />
<meta name="description" content="We use Regular Expressions or Regex capabilities in Python to extract data sourced from Bureau of Meteorology (BOM). Click Continue reading to know more about this project." />
<meta name="keywords" content="python, regex, regular expressions, BOM">

<meta property="og:site_name" content="Deepak Ramanath"/>
<meta property="og:title" content=""/>
<meta property="og:description" content="We use Regular Expressions or Regex capabilities in Python to extract data sourced from Bureau of Meteorology (BOM). Click Continue reading to know more about this project."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://deepakramanath.github.io/Data extraction using Regular Expressions.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2015-10-21 19:35:00+11:00"/>
<meta property="article:modified_time" content="2015-10-21 19:35:00+11:00"/>
<meta property="article:author" content="https://deepakramanath.github.io/author/deepak-ramanath.html">
<meta property="article:section" content="Python Projects"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="regex"/>
<meta property="article:tag" content="regular expressions"/>
<meta property="article:tag" content="BOM"/>
<meta property="og:image" content="https://secure.gravatar.com/avatar/e8607f9c9807350417679eff58ad56c4">

  <title>Deepak Ramanath &ndash; </title>

</head>
<body>
  <aside>
    <div>
      <a href="https://deepakramanath.github.io">
        <img src="https://secure.gravatar.com/avatar/e8607f9c9807350417679eff58ad56c4" alt="" title="">
      </a>
      <h1><a href="https://deepakramanath.github.io"></a></h1>


      <nav>
        <ul class="list">
          <li><a href="https://deepakramanath.github.io/pages/about.html#about">About</a></li>
          <li><a href="https://deepakramanath.github.io/pages/contact.html#contact">Contact</a></li>

          <li><a href="#" target="_blank">Python | Linux | Ansible</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-linkedin" href="https://au.linkedin.com/in/deepakramanath" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github" href="https://github.com/deepakramanath" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-gitlab" href="https://gitlab.com/deepakramanath" target="_blank"><i class="fa fa-gitlab"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/deepakramanath" target="_blank"><i class="fa fa-twitter"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://deepakramanath.github.io">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://deepakramanath.github.io/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="Data extraction using Regular Expressions"></h1>
    <p>
          Posted on Wed 21 October 2015 in <a href="https://deepakramanath.github.io/category/python-projects.html">Python Projects</a>


    </p>
  </header>


  <div>
    <div class="section" id="data-extraction-using-python-regular-expressions">
<h2>Data extraction using Python Regular Expressions</h2>
<p>This project can be found at the <a class="reference external" href="https://github.com/deepakramanath/Python-Regex-01">GitHub</a> repository, including the <a class="reference external" href="http://nbviewer.ipython.org/github/deepakramanath/Python-Regex-01/blob/master/data_regex.ipynb">IPython</a> notebook.</p>
<div class="section" id="introduction">
<h3>Introduction</h3>
<p>This program uses Python's regular expression or regex capabilities to extract
information/data using Python's <cite>re</cite> module. To regex some meaningful
expressions, a data file containing meteorological information obtained from
Australia's <a class="reference external" href="http://www.bom.gov.au/">Bureau of Meteorology</a> (BOM). is used. A set of alpha-numerical and numerical data are extracted using Python's regex. Although note that regex is not the most efficient way to carry out this type of data analysis and interpretation. Here it is just used to show the versatility of regex and to learn using it for Python.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
<p>First, we do the importing business. Here, we import some basic modules in
Python such as sys and os. The two new probably are <cite>re</cite>, which is the regular
expression or regex module and, <cite>matplotlib</cite> is the Python's plotting library.</p>
<div class="highlight"><pre><span></span><span class="n">headerPattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;pCode&gt;[A-Za-z]+[ ]?[a-z]+),(?P&lt;sNumber&gt;(\w+[ ]?)+),(?P&lt;ymd&gt;(\w+,?){,3}),(?P&lt;maxT&gt;(\w+[ ]?\w+)),&#39;</span><span class="p">)</span>
</pre></div>
<p>The first regex operation that we carry out is the compilation of the header
pattern in the <cite>data.txt</cite> file. Compiling the pattern converts to bytecode,
which is then subsequently used to search. At this stage, its ideal to look at
the <cite>data.txt</cite> if not already and to find the header information. As we see, the
header contains <cite>Product code</cite>, <cite>Bureau of Meteorology station number</cite>, <cite>Year</cite>,
<cite>month</cite>, <cite>day</cite>, etc and we try to extract all of these via the <cite>headerPattern</cite>
as shown above. Note that we use raw string <cite>r</cite> notation in Python and we also
group the regex using <cite>( )</cite>. Grouping regex is a useful feature when extracting
multiple information and they can be assigned with a choice of variable. For
example in the above, the <cite>Produce code</cite> is assigned to <cite>pCode</cite> and subsequently
when we search for <cite>Product code</cite> we can grab all the associated strings via
<cite>pCode</cite>. This feature will be become clear as we go further.</p>
<div class="highlight"><pre><span></span><span class="n">productCode</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;pC&gt;\w+)&#39;</span><span class="p">)</span>
<span class="n">stationNumber</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+,(?P&lt;sN&gt;\d+)&#39;</span><span class="p">)</span>
<span class="n">ymd</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+,\d+,(?P&lt;year&gt;\d+),(?P&lt;month&gt;\d+),(?P&lt;day&gt;\d+)&#39;</span><span class="p">)</span>
<span class="n">maxTemp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+,(\d+,){,4}(?P&lt;mT&gt;\d+.\d+)&#39;</span><span class="p">)</span>
</pre></div>
<p>The above are again the regex compiling for the actual data present in the
<cite>data.txt</cite> that we are interested to extract. Note the grouping and how the
variables are assigned for each of the regex.</p>
<div class="highlight"><pre><span></span><span class="n">monthValue</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dayValue</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">maxTempValue</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
<p>The above are the empty lists and will be used to update the relevant
information that is obtained when the regex are searched in the data file.</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;IDCJAC0010&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">headerSearch</span> <span class="o">=</span> <span class="n">headerPattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">print</span> <span class="n">headerSearch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;pCode&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">headerSearch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;sNumber&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">headerSearch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ymd&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">headerSearch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;maxT&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Product&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">pCSearch</span> <span class="o">=</span> <span class="n">productCode</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">sNSearch</span> <span class="o">=</span> <span class="n">stationNumber</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">ymdSearch</span> <span class="o">=</span> <span class="n">ymd</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">maxTempSearch</span> <span class="o">=</span> <span class="n">maxTemp</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

            <span class="n">month</span> <span class="o">=</span> <span class="n">ymdSearch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span>
            <span class="n">day</span> <span class="o">=</span> <span class="n">ymdSearch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>
            <span class="n">mTemp</span> <span class="o">=</span> <span class="n">maxTempSearch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;mT&#39;</span><span class="p">)</span>

            <span class="n">monthValue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
            <span class="n">dayValue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
            <span class="n">maxTempValue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mTemp</span><span class="p">)</span>

<span class="n">Product</span> <span class="n">code</span>
<span class="n">Bureau</span> <span class="n">of</span> <span class="n">Meteorology</span> <span class="n">station</span> <span class="n">number</span>
<span class="n">Year</span><span class="p">,</span><span class="n">Month</span><span class="p">,</span><span class="n">Day</span>
<span class="n">Maximum</span> <span class="n">temperature</span>
</pre></div>
<p>In the above piece of code, we open the <cite>data.txt</cite> for reading and then firstly
search the header pattern. Here, note that how we use the variables that we have
assigned such as <cite>pCode</cite>, <cite>sNumber</cite>, etc to store the search results. In a
similar fashion, we search the relevant data. After all the regexs are found,
the corresponding data are appended to the empty lists that we had before.</p>
<div class="highlight"><pre><span></span><span class="n">dataValues</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">monthValue</span><span class="p">,</span> <span class="n">dayValue</span><span class="p">,</span> <span class="n">maxTempValue</span><span class="p">)</span>
<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataValues</span><span class="p">)</span>

<span class="mi">365</span>
</pre></div>
<p>Here, we basically <cite>zip</cite> the three important lists making <cite>dataValues</cite> as a
tuple.</p>
<div class="highlight"><pre><span></span><span class="n">janValues</span> <span class="o">=</span> <span class="n">dataValues</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">31</span><span class="p">]</span>
<span class="n">janDay</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">janValues</span><span class="p">]</span>
<span class="n">janTemp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">janValues</span><span class="p">]</span>
</pre></div>
<p>This is where it gets a bit interesting! In the previous step, the length of the
<cite>dataValues</cite> is printed as <cite>365</cite> which indicates a year worth of data. Now since
we are interested only in the January, which has <cite>31</cite> days, we create another
variable called <cite>janValues</cite> and slice the tuple from <cite>0</cite> to <cite>31</cite>. Note that
<cite>janValues</cite> is also a tuple with the <cite>31</cite> data sets. Next we use list
comprehension to dissect the tuple. <cite>janValues</cite> has three lists for every set of
data representing month, day and maximum temperature, in which the index[0]
would correspond to the first list which is month, index[1] for day and index[2]
for temperature.</p>
<div class="highlight"><pre><span></span><span class="n">febValues</span> <span class="o">=</span> <span class="n">dataValues</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">janValues</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">janValues</span><span class="p">)</span><span class="o">+</span><span class="mi">28</span><span class="p">]</span>
<span class="n">febDay</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">febValues</span><span class="p">]</span>
<span class="n">febTemp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">febValues</span><span class="p">]</span>
</pre></div>
<p>Similar to the month of January, we slice the <cite>dataValues</cite> into <cite>28</cite> days and
assign the day and temperature variables.</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">janValues</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">janDay</span><span class="p">,</span> <span class="n">janTemp</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature [C]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">janValues</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Maximum temperature for the month of January, Station ID: IDCJAC0010&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s2">&quot;Evaluate January values&quot;</span>

<span class="k">if</span> <span class="n">febValues</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">febDay</span><span class="p">,</span><span class="n">febTemp</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature [C]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">febValues</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Maximum temperature for the month of Februrary, Station ID: IDCJAC0010&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s2">&quot;Evaluate Februrary values&quot;</span>
</pre></div>
</div>
</div>

  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://deepakramanath.github.io/tag/python.html">python</a>
      <a href="https://deepakramanath.github.io/tag/regex.html">regex</a>
      <a href="https://deepakramanath.github.io/tag/regular-expressions.html">regular expressions</a>
      <a href="https://deepakramanath.github.io/tag/bom.html">BOM</a>
    </p>
  </div>





</article>

    <footer>
<p>&copy;  2018</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Deepak Ramanath ",
  "url" : "https://deepakramanath.github.io",
  "image": "https://secure.gravatar.com/avatar/e8607f9c9807350417679eff58ad56c4",
  "description": ""
}
</script>

</body>
</html>